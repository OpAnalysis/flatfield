<!doctype html>
<html>

<head>

    <meta charset="utf-8">
    <title>Pin the Flat Field</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Import Leaflet CSS library -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>

    <!-- Custom CSS  -->
    <!-- <style type="text/css">
        html, body { width: 100%; height: 100%; margin: 0; }
        #map1, #map2 { width: 49.7%; height: 100%; }
        #map1 { float: left; }
        #map2 { float: right; }
    </style>-->
    
    <!-- Bootstrap CSS -->
    <!-- <link href="./css/bootstrap.css" rel="stylesheet"> OFFLINE MODE-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <style type="text/css">
        body {
            padding-top: 60px;
            padding-bottom: 40px;
        }
        #map1 {
              position: relative;
              border: 1px solid black;
              border-radius: 8px;
              height: 400px;  
              width: 50%;  
            }
        #map2 {
              position: relative;
              border: 1px solid black;
              border-radius: 8px;
              height: 400px;  
              width: 50%;  
            }
        #map3 {
              position: relative;
              border: 1px solid black;
              border-radius: 8px;
              height: 400px;  
              width: 50%;  
            }
        #map4 {
              position: relative;
              border: 1px solid black;
              border-radius: 8px;
              height: 400px;  
              width: 50%;  
            }


    </style>

</head>

<body>


    <!--------------------------------------------------
                  CREATE DIVS FOR MAP PANELS
    --------------------------------------------------->

    <!--<div id="map1"></div>
    <div id="map2"></div>-->

    <div class="container">
        <div class="hero-unit">
            <h1>Pin the Flat Field</h1>
            <p>Place a pin and get info on natural phenomena.</p>
            <p><a class="btn btn-primary btn-large">Op A 2024 »</a></p>
        </div>

        <div class="row">
            <div class="span6" id="map1"></div>
            <div class="span6" id="map2"></div>
        </div>
        <div class="row">
            <div class="span6" id="map3"></div>
            <div class="span6" id="map4"></div>
        </div>
        <hr>
        <footer>
            <p>Pin the Flatt Field 2024</p>
        </footer>

    </div>
 
    <!--------------------------------------------------
                IMPORT JAVASCRIPT AND PLUGINS
    --------------------------------------------------->

    <!-- Import Leaflet JavaScript library -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>
    
    <!-- Import Leaflet.Sync plugin -->
    <script src="L.Map.Sync.js"></script>

    <!-- Bootstrap -->

    <!-- <script src="./js/jquery-3.6.0.js"></script>
    <script src="./js/bootstrap.js"></script> OFFLINE -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <!--------------------------------------------------
                      MAIN JAVASCRIPT
    --------------------------------------------------->

    <script type="text/javascript">


        /*================================================
                            BASE MAPS
         =================================================*/

        // Greyscale base map 1
        var grey1 = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                      	attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                      	subdomains: 'abcd',
                     	maxZoom: 20
                    });

        // Greyscale base map 2
        var grey2 = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                      	attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                      	subdomains: 'abcd',
                     	maxZoom: 20
                    });

        // Open Street Map base map 1
        var osm1 = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        maxZoom: 19,
                        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
                    })
 
        // Open Street Map base map 2
        var osm2 = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        maxZoom: 19,
                        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
                    })
 
        // Google satellite base map 1
        var satellite1 = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{
                        maxZoom: 20,
                        subdomains:['mt0','mt1','mt2','mt3']
                    });

        // Google satellite base map 2
        var satellite2 = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{
                        maxZoom: 20,
                        subdomains:['mt0','mt1','mt2','mt3']
                    });


        /*================================================
                            OVERLAYS
         =================================================*/
     
        // Satellite cloud observation (GOES-East Day Visibility) from MSC GeoMet (GeoMet-Weather)
        var geometGOES_EastDayVisibility = L.tileLayer.wms("https://geo.weather.gc.ca/geomet", {
            layers: 'GOES-East_1km_DayVis',
            version: '1.3.0',
            format: 'image/png',
            transparent: true,
            opacity: 0.5,
            attribution: 'MSC GeoMet'
        });

        // North American composite weather radar (rain rate [mm/h]) from MSC GeoMet (GeoMet-Weather)
        var geometWeatherRadarRainRate = L.tileLayer.wms("https://geo.weather.gc.ca/geomet", {
            layers: 'RADAR_1KM_RRAI',
            version: '1.3.0',
            format: 'image/png',
            transparent: true,
            opacity: 0.5,
            attribution: 'MSC GeoMet'
        });

        // North American composite weather radar (snow rate [cm/h]) from MSC GeoMet (GeoMet-Weather)
        var geometWeatherRadarSnowRate = L.tileLayer.wms("https://geo.weather.gc.ca/geomet", {
            layers: 'RADAR_1KM_RSNO',
            version: '1.3.0',
            format: 'image/png',
            transparent: true,
            opacity: 0.5,
            attribution: 'MSC GeoMet'
        });

        // US weather radar from Nexrad
        var nexradWeatherRadar = L.tileLayer.wms("http://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi", {
            layers: 'nexrad-n0r-900913',
            format: 'image/png',
            transparent: true,
            attribution: "Weather data © 2012 IEM Nexrad"
        });

        // Canada Lightning Danger Map from MSC GeoMet (GeoMet-Weather)
        var geometCanadaLightningDanger = L.tileLayer.wms("https://geo.weather.gc.ca/geomet", {
            layers: 'Lightning_2.5km_Density',
            version: '1.3.0',
            format: 'image/png',
            transparent: true,
            opacity: 0.5,
            attribution: 'MSC GeoMet'
        });

        // Canadian accumulated precipitation in last 24 hours at local noon from CWFIS
        var precipitationLast24Hours = L.tileLayer.wms("https://cwfis.cfs.nrcan.gc.ca/geoserver/public/wms?service=WMS", {
            layers: 'precip_current',
            format: 'image/png',
            transparent: true,
            opacity: 0.5,
            attribution: 'CWFIS',
        });

        // Canadian relative humidity at local noon from CWFIS
        var relativeHumidityAtNoon = L.tileLayer.wms("https://cwfis.cfs.nrcan.gc.ca/geoserver/public/wms?service=WMS", {
            layers: 'rh_current',
            format: 'image/png',
            transparent: true,
            opacity: 0.5,
            attribution: 'CWFIS',
        });

        // Canadian temperature at local noon from CWFIS
        var temperatureAtNoon = L.tileLayer.wms("https://cwfis.cfs.nrcan.gc.ca/geoserver/public/wms?service=WMS", {
            layers: 'temp_current',
            format: 'image/png',
            transparent: true,
            opacity: 0.5,
            attribution: 'CWFIS',
        });

        // Canadian weather alerts from MSC GeoMet (GeoMet-Weather)
        var weatherAlerts = L.tileLayer.wms("https://geo.weather.gc.ca/geomet/?lang=en&version=1.3.0", {
            layers: 'ALERTS',
            format: 'image/png',
            transparent: true,
            opacity: 0.5,
            attribution: 'MSC GeoMet',
        });

        // Canadian wind direction at local noon from CWFIS
        var windDirectionAtNoon = L.tileLayer.wms("https://cwfis.cfs.nrcan.gc.ca/geoserver/public/wms?service=WMS", {
            layers: 'wdir_current',
            format: 'image/png',
            transparent: true,
            opacity: 0.5,
            attribution: 'CWFIS',
        });

        // Canadian wind speed at local noon from CWFIS
        var windSpeedAtNoon = L.tileLayer.wms("https://cwfis.cfs.nrcan.gc.ca/geoserver/public/wms?service=WMS", {
            layers: 'ws_current',
            format: 'image/png',
            transparent: true,
            opacity: 0.5,
            attribution: 'CWFIS',
        });

        // Canadian active wildfires status from CWFIS
        var activeFiresStatus = L.tileLayer.wms("https://cwfis.cfs.nrcan.gc.ca/geoserver/public/wms?service=WMS", {
            layers: 'activefires_current',
            format: 'image/png',
            transparent: true,
            opacity: 0.5,
            attribution: 'CWFIS',
        });

        // Canadian active wildfire perimeters from CWFIS
        var activeFirePerimeters = L.tileLayer.wms("https://cwfis.cfs.nrcan.gc.ca/geoserver/public/wms?service=WMS", {
            layers: 'm3_polygons_current',
            format: 'image/png',
            transparent: true,
            opacity: 0.5,
            attribution: 'CWFIS',
        });

        // Canadian current fire danger from CWFIS
        var currentFireDanger = L.tileLayer.wms("https://cwfis.cfs.nrcan.gc.ca/geoserver/public/wms?service=WMS", {
            layers: 'fdr_current',
            format: 'image/png',
            transparent: true,
            opacity: 0.5,
            attribution: 'CWFIS',
        });

        // Canadian current fire weather index from CWFIS
        var currentFireWeatherIndex = L.tileLayer.wms("https://cwfis.cfs.nrcan.gc.ca/geoserver/public/wms?service=WMS", {
            layers: 'fwi_current',
            format: 'image/png',
            transparent: true,
            opacity: 0.5,
            attribution: 'CWFIS',
        });

        // Canadian current head fire intensity from CWFIS
        var currentHeadFireIntensity = L.tileLayer.wms("https://cwfis.cfs.nrcan.gc.ca/geoserver/public/wms?service=WMS", {
            layers: 'hfi_current',
            format: 'image/png',
            transparent: true,
            opacity: 0.5,
            attribution: 'CWFIS',
        });

        // Canadian current fire rate of spread from CWFIS
        var currentFireRateOfSpread = L.tileLayer.wms("https://cwfis.cfs.nrcan.gc.ca/geoserver/public/wms?service=WMS", {
            layers: 'ros_current',
            format: 'image/png',
            transparent: true,
            opacity: 0.5,
            attribution: 'CWFIS',
        });


        /*================================================
                            MARKERS
         =================================================*/

//        var singleMarker = L.marker([initialMapLat, initialMapLng]);
//        var popup = singleMarker.bindPopup('This is an example of a popup.').openPopup()
//        popup.addTo(map);


        /*================================================
                           MAP PANELS
         =================================================*/

        // Initial parameters for map panels
        var initialMapLat = 54;     // iniital latitude
        var initialMapLng = -98;    // initial longitude
        var initialMapZoom = 3;     // initial zoom level
        var initialMapCentre = [initialMapLat, initialMapLng];
        var minPanelZoom = 3

        // Set default base maps
        var defaultBaseMap1 = grey1;
        var defaultBaseMap2 = osm2;

        // Define map panel 1
        var map1 = L.map('map1', {
            layers: [defaultBaseMap1],
            center: initialMapCentre,
            zoom: initialMapZoom,
            minZoom: minPanelZoom
        });

        // Define map panel 2
        var map2 = L.map('map2', {
            layers: [defaultBaseMap2],
            center: initialMapCentre,
            zoom: initialMapZoom,
            zoomControl: false,
            minZoom: minPanelZoom
        });

        // Active overlays
        weatherAlerts.addTo(map1)
        activeFirePerimeters.addTo(map2)
        activeFiresStatus.addTo(map2)

        /*================================================
                        LAYER CONTROLLERS
         =================================================*/

        // List base maps to include in layer controller 1
        var baseMaps1 = {
            "Greyscale": grey1,
            "Open Street Map": osm1,
            "Satellite": satellite1
        };

        // List base maps to include in layer controller 2
        var baseMaps2 = {
            "Greyscale": grey2,
            "Open Street Map": osm2,
            "Satellite": satellite2
        };

        // List overlays to include in layer controller 1
        var overlayMaps1 = {
//            "Marker": singleMarker,
            "Alerts": weatherAlerts,
            "Cloud cover (daytime)": geometGOES_EastDayVisibility,
            "Lightning density (last 10 min)": geometCanadaLightningDanger,
            "Precipitation (last 24 h)": precipitationLast24Hours,
            "Relative humidity (noon)": relativeHumidityAtNoon,
            "Temperature (noon)": temperatureAtNoon,
            "Weather radar (rain rate)": geometWeatherRadarRainRate,
            "Wind direction (noon)": windDirectionAtNoon,
            "Wind speed (noon)": windSpeedAtNoon
        };

        // List overlays to include in layer controller 2
        var overlayMaps2 = {
            "Active fires (areas)": activeFirePerimeters,
            "Active fires (status)": activeFiresStatus,
            "Fire danger": currentFireDanger,
            "Fire rate of spread": currentFireRateOfSpread,
            "Fire weather index": currentFireWeatherIndex,
            "Head fire intensity": currentHeadFireIntensity
        };

        // Add layer controllers to maps
        var layerControl1 = L.control.layers(baseMaps1, overlayMaps1, { collapsed: true }).addTo(map1);
        var layerControl2 = L.control.layers(baseMaps2, overlayMaps2, { collapsed: true }).addTo(map2);

        // Synchronize all map pairs in both directions
        map1.sync(map2);
        map2.sync(map1);

    </script>

    

</body>
</html>
